#!/usr/bin/env python
# -*- coding: utf-8 -*-
# filename : plot_movement.py

# plot vehicle movement in sumo fcd output

#import file
import csv
import numpy as np
import cv2

#DEFINE CONSTANT
GRAPH_SIZE = 4096
INPUT_FILENAME = './data/time_sumo_result.csv'
origin = [139.562110,35.816635]
max_origin = [139.919635,35.531365]
width = abs(max_origin[0] - origin[0])
height = abs(max_origin[1] - origin[1])
img = np.zeros((GRAPH_SIZE,GRAPH_SIZE,3),np.uint8)
PAST_POS = {}

#DEFINE METHOD
def csv_read(filename, encoding):
    with open(filename, "rb") as f:
        csvfile = csv.reader(f)
        rows = [[c.decode(encoding) for c in r] for r in csvfile]
        return rows

if __name__ == '__main__' :
    file = open(INPUT_FILENAME,'r')
    for time in range(1,61):
        i = 0
        rows = csv.reader(file)
        img.fill(255)
        print(str(time) + ' start')
        for line in rows:
            if int(line[0]) == time:
                i += 1
                lat = float(line[2])
                lon = float(line[3])
                cv2.circle(img,(int(abs(lon-origin[0])/width * GRAPH_SIZE),int(abs(lat-origin[1])/height * GRAPH_SIZE)),1,(0,0,255),-1)
            if int(line[0]) > time:
                    break;
        cv2.imwrite('./result/img' + str(time) + '.jpg',img)
        print(str(time) + ':' + str(i))
